{% if product.type == 'Personalized' %}
<script>
  var BOLD = BOLD || {};
  BOLD.personalizer = BOLD.personalizer || {};
  BOLD.personalizer.product = {{ product | json }};
  BOLD.personalizer.shop = "{{ shop.url }}";
  BOLD.personalizer.permanent_domain = "{{ shop.permanent_domain }}";

  BOLD.Settings = {
    allowedCharacters: ".,a-z0-9() ?!:$;@/\\-&\"'#"
  }
</script>

<script src="{{ 'yaya-personalizer.min.js' | asset_url }}" async></script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    // BOLD personalizer file is minified... Waiting for it to load then moving the size/pack label to where the personalizer image is.
    var isPersonalizerLoaded = window.setInterval(function () {
      if (window.BOLD && window.BOLD.personalizer && typeof window.BOLD.personalizer.init === "function") {
        BOLD.personalizer.init();
        window.BOLD.personalizer.valid = false;
      }
      var $desktopPersonalizerSelectorImage = $('.desktop-personalizer-main-image'),
      $sizingPreviewSelector = $('.sizing-preview');

      var isLoaded = $desktopPersonalizerSelectorImage.length;

      if (isLoaded) {
        // toggle
        $(".personalizer-tooltip-wrapper").click(function () {
          $("#pdp-pc-image").addClass("active");
        });
        $(".personalizer-text-option input").on("keypress", function () {
          $("#pdp-pc-image").addClass("active");
        });
      }

      if (isLoaded && $sizingPreviewSelector.length) {
        $desktopPersonalizerSelectorImage.prepend($sizingPreviewSelector);
      }

      if (isLoaded) window.clearInterval(isPersonalizerLoaded); // this line breaks out of the loop once personalizer is loaded.
    }, 200);

    function ifPersonalizerFailsToLoad() {
      setTimeout(function () {
        window.clearInterval(isPersonalizerLoaded);
      }, 15000)
    }

    // isPersonalizerLoaded;
    ifPersonalizerFailsToLoad();

    // show option production-time
    // but in some case production-time is merged to "Personalize It"(".personalizer-mobile-portal")
    {% if product.metafields.product_customizer %}
    // if (isMobile.any) {
      var product_customizer_array = Object.keys({{ product.metafields.product_customizer | json }});
      // console.log(product_customizer_array);
      if (product_customizer_array && product_customizer_array.length > 1) {
        $(".product-customizer-option[data-option-name*=production-time]").show();
      }
    // }
    {% endif %}
  });
</script>

{% endif %}
