{
  "id": "{{- product.id -}}",
  "url": {{- product.url | json -}},
  "title": {{- product.title | json -}},
  "image": {{- product.featured_image | json -}},
  "variantID": {{- product.variants[0].id -}},
  "price": {{- product.price | money_without_currency | json -}},
  "compare_price": {{- product.compare_at_price | money_without_currency | json -}},
  "tags": {{- product.tags | json -}},
  "type": {{- product.type | json -}},
  "review": 1,
  "reviews_average": {{- product.metafields.stamped.reviews_average | times: 1 -}},
  "reviews_count": {{- product.metafields.stamped.reviews_count | plus: 0 -}},
  "personalized": {% if product.type == 'Personalized' %}true{% else %}false{% endif %},
  "size": {{ product.metafields.c_f.sizing | json }},
  "inventory_quantity": {{- product.variants[0].inventory_quantity | json -}},
  "inventory_policy": {{- product.variants[0].inventory_policy | json -}},
  "sold_out": [
    {%- for variant in product.variants -%}
      {%- assign variantMetafield = variant.metafields.deposco['Sold Out'] | downcase -%}
      {%- assign metaDate = variantMetafield | date: '%B %d %Y' -%}
      {%- if variantMetafield contains "sold out until" and metaDate != variantMetafield -%}
        {%- assign txtSoldOut = "Preorder: Available on " | append: metaDate -%}
      {%- else -%}
        {%- assign txtSoldOut = "" -%}
      {%- endif -%}
      {{- txtSoldOut | json -}}
      {% if forloop.last == false %},{% endif%}
    {%- endfor -%}
  ],
  "variants": [
    {%- assign variants = '' -%}
    {%- for variant in product.variants -%}
      {
        "id": {{- variant.id | json -}},
        "inventory_policy": {{- variant.inventory_policy | json -}},
        "inventory_quantity": {{- variant.inventory_quantity | json -}},

        {%- assign variantMetafield = variant.metafields.deposco['Sold Out'] | downcase -%}
        {%- assign metaDate = variantMetafield | date: '%B %d %Y' -%}
        {%- if variantMetafield contains "sold out until" and metaDate != variantMetafield -%}
          {%- assign txtSoldOut = "Preorder: Available on " | append: metaDate -%}
        {%- else -%}
          {%- assign txtSoldOut = "" -%}
        {%- endif -%}
        "sold_out": {{- txtSoldOut | json -}},

        {%- assign threshold = variant.metafields.deposco['threshold'] -%}
        {%- if threshold != blank -%}
          {%- assign threshold = threshold | plus: 0 -%}
        {%- else -%}
          {%- assign threshold = "0" | plus: 0 -%}
        {%- endif -%}
        "threshold":  {{- threshold -}}
      }
      {% if forloop.last == false %},{% endif%}
    {%- endfor -%}
  ],
  "images": {{- product.images | slice: 1, 3 | json -}}
}