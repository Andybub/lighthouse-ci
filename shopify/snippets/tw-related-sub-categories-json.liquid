{%- capture subCategories -%}
  [
  {%- for childLink in links -%}
    {% if childLink.type == "collection_link" %}
      {
        "id": {{ childLink.object.id | json }},
        "title": {{ childLink.object.title | json }},
        "image": {{ childLink.object.featured_image | image_url | json }},
        "url": {{ childLink.object.url | json }},
        "products": [
          {% for i in (1..3) %}
            {% assign product = childLink.object.products[i] %}
            {
              "id": "{{ product.id }}",
              "variantID": "{{ product.variants[0].id }}",
              "title": {{ product.title | json }},
              "image": {{ product.featured_image | image_url | json }},
              "price": {{ product.price | money_without_currency | json }},
              "compare_price": {{ product.compare_at_price | money_without_currency | json }},
              "reviews_average": {{ product.metafields.stamped.reviews_average | times: 1 | default: 0 | json }},
              "reviews_count": {{ product.metafields.stamped.reviews_count | times: 1 | default: 0 | json }},
              "url": {{ product.url | json }},
              "tags": {{ product.tags | json }},
              "type": {{ product.type | json }}
            }
            {% unless forloop.last %},{% endunless %}
          {% endfor %}
        ]
      }
      {% unless forloop.last %},{% endunless %}
    {% endif %}
  {%- endfor %}
  ]
{%- endcapture -%}
<script type="application/json" id="related-sub-categories">
  {{- subCategories | strip_newlines -}}
</script>